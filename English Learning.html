<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinguistTrack - Daily English Mastery</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .skill-card { transition: transform 0.2s; }
        .skill-card:hover { transform: translateY(-2px); }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        @media (max-width: 1023px) {
            body { padding-bottom: 70px; }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">



    <!-- Mobile Footer Navigation -->
    <nav class="lg:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 z-50 shadow-lg">
        <div class="flex justify-around items-center py-2 px-4 safe-area-bottom">
            <button onclick="switchTab('tasks')" id="tab-tasks" class="flex flex-col items-center gap-1 px-5 py-2 rounded-2xl transition-all text-blue-600 bg-blue-50">
                <i class="fas fa-tasks text-xl"></i>
                <span class="text-[10px] font-semibold">Tasks</span>
            </button>
            <button onclick="switchTab('dashboard')" id="tab-dashboard" class="flex flex-col items-center gap-1 px-5 py-2 rounded-2xl transition-all text-slate-400 hover:text-slate-600">
                <i class="fas fa-chart-pie text-xl"></i>
                <span class="text-[10px] font-semibold">Dashboard</span>
            </button>
            <button onclick="switchTab('backup')" id="tab-backup" class="flex flex-col items-center gap-1 px-5 py-2 rounded-2xl transition-all text-slate-400 hover:text-slate-600">
                <i class="fas fa-cloud text-xl"></i>
                <span class="text-[10px] font-semibold">Backup</span>
            </button>
        </div>
    </nav>

    <!-- Main App -->
    <div class="max-w-7xl mx-auto px-4 py-6 pb-24 lg:pb-8">
        <!-- Header -->
        <header class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-3">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-slate-900">Hello, <span id="display-name" class="text-blue-600">Khaing Htet Htet Kyaw</span>! üëã</h1>
                <p id="motivational-msg" class="text-slate-500 mt-1 italic text-sm md:text-base">"The limit of your language is the limit of your world."</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="bg-orange-100 text-orange-700 px-3 py-1.5 md:px-4 md:py-2 rounded-full font-bold flex items-center gap-2 text-sm">
                    <i class="fas fa-fire"></i> <span id="streak-count">0</span> Day Streak
                </div>
                <button onclick="exportData()" class="text-slate-500 hover:text-blue-600 text-sm font-medium hidden lg:block">
                    <i class="fas fa-download mr-1"></i> Export Data
                </button>
            </div>
        </header>

        <div class="flex flex-col lg:grid lg:grid-cols-12 gap-6">
            <!-- Left Column: Dashboard & Charts -->
            <div id="dashboard-tab" class="lg:col-span-7 space-y-6 order-2 lg:order-1">
                <!-- Summary Stats -->
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                        <p class="text-xs text-slate-500 uppercase font-bold">Total Tasks</p>
                        <p id="stat-total" class="text-2xl font-bold">0</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                        <p class="text-xs text-slate-500 uppercase font-bold">Completed</p>
                        <p id="stat-done" class="text-2xl font-bold text-green-600">0</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                        <p class="text-xs text-slate-500 uppercase font-bold">In Progress</p>
                        <p id="stat-pending" class="text-2xl font-bold text-blue-600">0</p>
                    </div>
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                        <p class="text-xs text-slate-500 uppercase font-bold">Accuracy</p>
                        <p id="stat-percent" class="text-2xl font-bold text-purple-600">0%</p>
                    </div>
                </div>

                <!-- Chart Section -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-6 gap-3">
                        <h3 class="text-lg font-bold">Learning Progress</h3>
                        <div class="flex flex-wrap items-center gap-2">
                            <div class="flex gap-1 bg-slate-100 p-1 rounded-lg">
                                <button onclick="updateChartType('daily')" id="btn-daily" class="px-3 py-1 text-[10px] sm:text-xs font-semibold rounded-md bg-white text-blue-700 shadow-sm transition-all">Daily</button>
                                <button onclick="updateChartType('monthly')" id="btn-monthly" class="px-3 py-1 text-[10px] sm:text-xs font-semibold rounded-md text-slate-600 hover:bg-white/50 transition-all">Monthly</button>
                            </div>
                            <input type="month" id="month-picker" onchange="updateChart()" class="text-xs border border-slate-200 rounded-lg px-2 py-1 bg-white outline-none focus:ring-2 focus:ring-blue-500 hidden">
                        </div>
                    </div>
                    <div class="h-48 sm:h-64">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>

                <!-- Skill Focus -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="text-lg font-bold mb-4">Skill Focus Areas</h3>
                    <div id="skill-bars" class="space-y-4">
                        <!-- Bars injected by JS -->
                    </div>
                </div>
            </div>

            <!-- Backup Tab - Separate from Dashboard for mobile -->
            <div id="backup-tab" class="hidden lg:hidden order-2">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center">
                            <i class="fas fa-cloud text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h3 class="text-lg font-bold">Data Management</h3>
                            <p class="text-sm text-slate-500">Backup & restore your progress</p>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="p-5 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl border border-blue-100">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-download text-white"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-sm">Export Data</h4>
                                    <p class="text-xs text-slate-500">Save your progress locally</p>
                                </div>
                            </div>
                            <p class="text-xs text-slate-600 mb-4">Download all your tasks, history, and streak data as a JSON file. Keep it safe for backup!</p>
                            <button onclick="exportData()" class="w-full py-3 bg-blue-600 text-white rounded-xl text-sm font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2">
                                <i class="fas fa-download"></i> Download Backup
                            </button>
                        </div>
                        <div class="p-5 bg-gradient-to-br from-green-50 to-emerald-50 rounded-xl border border-green-100">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-10 h-10 bg-green-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-upload text-white"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-sm">Import Data</h4>
                                    <p class="text-xs text-slate-500">Restore from backup</p>
                                </div>
                            </div>
                            <p class="text-xs text-slate-600 mb-4">Upload a previously saved backup file to restore all your learning progress and history.</p>
                            <label class="block">
                                <input type="file" id="import-file-mobile" accept=".json" onchange="importData(event)" class="hidden"/>
                                <div class="w-full py-3 bg-green-600 text-white rounded-xl text-sm font-bold hover:bg-green-700 transition flex items-center justify-center gap-2 cursor-pointer">
                                    <i class="fas fa-upload"></i> Choose Backup File
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Task Management -->
            <div id="tasks-tab" class="lg:col-span-5 space-y-6 order-1 lg:order-2">
                <!-- Add Task Form -->
                <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="text-lg font-bold mb-3 text-slate-800">Plan Practice</h3>
                    <div class="flex flex-col gap-3">
                        <input type="text" id="task-input" placeholder="What will you practice?" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50">
                        <div class="grid grid-cols-2 gap-2">
                            <select id="task-skill" class="px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none bg-slate-50 text-sm">
                                <option value="Reading">üìñ Reading</option>
                                <option value="Writing">‚úçÔ∏è Writing</option>
                                <option value="Listening">üéß Listening</option>
                                <option value="Speaking">üó£Ô∏è Speaking</option>
                            </select>
                            <button onclick="addTask()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition text-sm">Add</button>
                        </div>
                    </div>
                </div>

                <!-- Task List -->
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                    <div class="p-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                        <h3 class="font-bold">Daily Tasks</h3>
                        <span id="task-count" class="text-xs font-bold px-2 py-1 bg-blue-100 text-blue-700 rounded-full">0 Tasks</span>
                    </div>
                    <div id="task-list" class="max-h-[500px] overflow-y-auto custom-scrollbar">
                        <!-- Tasks injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State Management
        let appState = {
            user: { name: "Learner", streak: 0, lastVisit: "" },
            tasks: [],
            history: {}, // Format: { "YYYY-MM-DD": { Reading: 0, Writing: 0, ... } }
            viewMode: 'daily'
        };

        const SKILLS = ['Reading', 'Writing', 'Listening', 'Speaking'];
        const SKILL_COLORS = {
            Reading: '#3b82f6',   // Blue
            Writing: '#8b5cf6',   // Purple
            Listening: '#10b981', // Green
            Speaking: '#f59e0b'   // Amber
        };

        let progressChart = null;
        let skillPieChart = null;

        // Tab Switching for Mobile
        function switchTab(tabName) {
            // Get all tab elements
            const tasksTab = document.getElementById('tasks-tab');
            const dashboardTab = document.getElementById('dashboard-tab');
            const backupTab = document.getElementById('backup-tab');

            // Hide all tabs
            tasksTab.classList.add('hidden');
            dashboardTab.classList.add('hidden');
            backupTab.classList.add('hidden');

            // Deactivate all tab buttons (footer style)
            ['tasks', 'dashboard', 'backup'].forEach(t => {
                const btn = document.getElementById(`tab-${t}`);
                if (btn) {
                    btn.classList.remove('text-blue-600', 'bg-blue-50');
                    btn.classList.add('text-slate-400');
                }
            });

            // Show selected tab and activate button
            const activeBtn = document.getElementById(`tab-${tabName}`);
            
            if (activeBtn) {
                activeBtn.classList.remove('text-slate-400');
                activeBtn.classList.add('text-blue-600', 'bg-blue-50');
            }

            // Show the appropriate tab
            if (tabName === 'tasks') {
                tasksTab.classList.remove('hidden');
            } else if (tabName === 'dashboard') {
                dashboardTab.classList.remove('hidden');
                setTimeout(() => {
                    if (progressChart) progressChart.resize();
                }, 50);
            } else if (tabName === 'backup') {
                backupTab.classList.remove('hidden');
            }
        }

        // Initialization
        window.onload = () => {
            const savedData = localStorage.getItem('linguistTrack_data');
            if (savedData) {
                appState = JSON.parse(savedData);
            } else {
                // Initialize default state for first time users
                appState.user.name = "Learner";
                appState.user.lastVisit = new Date().toISOString().split('T')[0];
                saveToStorage();
            }
            
            checkStreak();
            initChart();
            // initPieChart(); // Pie chart removed
            renderAll();
            
            // Initialize mobile view
            if (window.innerWidth < 1024) {
                switchTab('tasks');
            }
        };

        function saveToStorage() {
            localStorage.setItem('linguistTrack_data', JSON.stringify(appState));
        }

        function checkStreak() {
            const today = new Date().toISOString().split('T')[0];
            const last = appState.user.lastVisit;
            
            if (last) {
                const lastDate = new Date(last);
                const todayDate = new Date(today);
                const diffTime = Math.abs(todayDate - lastDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) {
                    // Stayed consistent!
                } else if (diffDays > 1) {
                    appState.user.streak = 0;
                }
            }
            appState.user.lastVisit = today;
            saveToStorage();
        }

        // Task Logic
        function addTask() {
            const text = document.getElementById('task-input').value.trim();
            const skill = document.getElementById('task-skill').value;
            if (!text) return;

            const newTask = {
                id: Date.now(),
                text,
                skill,
                completed: false,
                date: new Date().toISOString().split('T')[0]
            };

            appState.tasks.unshift(newTask);
            document.getElementById('task-input').value = '';
            renderAll();
            saveToStorage();
        }

        function toggleTask(id) {
            const task = appState.tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                updateHistory(task);
                updateStreak();
                renderAll();
                saveToStorage();
            }
        }

        function deleteTask(id) {
            appState.tasks = appState.tasks.filter(t => t.id !== id);
            renderAll();
            saveToStorage();
        }

        function updateHistory(task) {
            const date = task.date;
            if (!appState.history[date]) {
                appState.history[date] = { Reading: 0, Writing: 0, Listening: 0, Speaking: 0 };
            }
            
            if (task.completed) {
                appState.history[date][task.skill]++;
            } else {
                appState.history[date][task.skill] = Math.max(0, appState.history[date][task.skill] - 1);
            }
        }

        function updateStreak() {
            const today = new Date().toISOString().split('T')[0];
            const completedToday = appState.tasks.some(t => t.date === today && t.completed);
            
            // Basic streak: increment if first completion of the day
            // This is a simplified logic
            const hasCompletedSomethingBefore = Object.values(appState.history[today] || {}).some(v => v > 0);
            if (completedToday && !hasCompletedSomethingBefore) {
                appState.user.streak++;
            }
        }

        // UI Rendering
        function renderAll() {
            document.getElementById('display-name').innerText = appState.user.name;
            document.getElementById('streak-count').innerText = appState.user.streak;
            
            renderTasks();
            renderStats();
            renderSkillBars();
            updateChart();
            // updatePieChart(); // Removed
            updateMotivation();
        }

        function renderTasks() {
            const list = document.getElementById('task-list');
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = appState.tasks.filter(t => t.date === today);
            
            document.getElementById('task-count').innerText = `${todayTasks.length} Tasks`;

            if (todayTasks.length === 0) {
                list.innerHTML = `
                    <div class="p-8 text-center text-slate-400">
                        <i class="fas fa-clipboard-list text-4xl mb-2"></i>
                        <p>No tasks for today. Let's add some!</p>
                    </div>
                `;
                return;
            }

            list.innerHTML = todayTasks.map(task => `
                <div class="flex items-center justify-between p-4 border-b border-slate-50 hover:bg-slate-50 transition group">
                    <div class="flex items-center gap-3">
                        <button onclick="toggleTask(${task.id})" class="w-6 h-6 rounded-full border-2 flex items-center justify-center transition ${task.completed ? 'bg-green-500 border-green-500 text-white' : 'border-slate-300'}">
                            ${task.completed ? '<i class="fas fa-check text-xs"></i>' : ''}
                        </button>
                        <div>
                            <p class="${task.completed ? 'line-through text-slate-400' : 'font-medium'}">${task.text}</p>
                            <span class="text-[10px] uppercase font-bold tracking-wider" style="color: ${SKILL_COLORS[task.skill]}">${task.skill}</span>
                        </div>
                    </div>
                    <button onclick="deleteTask(${task.id})" class="opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            `).join('');
        }

        function renderStats() {
            const today = new Date().toISOString().split('T')[0];
            const todayTasks = appState.tasks.filter(t => t.date === today);
            const total = todayTasks.length;
            const done = todayTasks.filter(t => t.completed).length;
            const pending = total - done;
            const percent = total > 0 ? Math.round((done / total) * 100) : 0;

            document.getElementById('stat-total').innerText = total;
            document.getElementById('stat-done').innerText = done;
            document.getElementById('stat-pending').innerText = pending;
            document.getElementById('stat-percent').innerText = `${percent}%`;
        }

        function renderSkillBars() {
            const container = document.getElementById('skill-bars');
            const today = new Date().toISOString().split('T')[0];
            const historyToday = appState.history[today] || { Reading: 0, Writing: 0, Listening: 0, Speaking: 0 };
            
            container.innerHTML = SKILLS.map(skill => {
                const count = historyToday[skill] || 0;
                const max = 5; // Target per skill
                const progress = Math.min((count / max) * 100, 100);
                
                return `
                    <div>
                        <div class="flex justify-between text-sm mb-1">
                            <span class="font-medium">${skill}</span>
                            <span class="text-slate-500">${count} completed</span>
                        </div>
                        <div class="w-full bg-slate-100 rounded-full h-2">
                            <div class="h-2 rounded-full transition-all duration-500" style="width: ${progress}%; background-color: ${SKILL_COLORS[skill]}"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Charts Logic
        function initChart() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            progressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: SKILLS.map(skill => ({
                        label: skill,
                        data: [],
                        backgroundColor: SKILL_COLORS[skill],
                        borderRadius: 4
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 12, usePointStyle: true } }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { stepSize: 1 }, grid: { display: false } },
                        x: { grid: { display: false } }
                    }
                }
            });
            updateChart();
        }

        function updateChartType(type) {
            appState.viewMode = type;
            const dailyBtn = document.getElementById('btn-daily');
            const monthlyBtn = document.getElementById('btn-monthly');
            const monthPicker = document.getElementById('month-picker');

            if (type === 'daily') {
                dailyBtn.className = "px-3 py-1 text-[10px] sm:text-xs font-semibold rounded-md bg-white text-blue-700 shadow-sm transition-all";
                monthlyBtn.className = "px-3 py-1 text-[10px] sm:text-xs font-semibold rounded-md text-slate-600 hover:bg-white/50 transition-all";
                monthPicker.classList.add('hidden');
            } else {
                monthlyBtn.className = "px-3 py-1 text-[10px] sm:text-xs font-semibold rounded-md bg-white text-blue-700 shadow-sm transition-all";
                dailyBtn.className = "px-3 py-1 text-[10px] sm:text-xs font-semibold rounded-md text-slate-600 hover:bg-white/50 transition-all";
                monthPicker.classList.remove('hidden');
                if (!monthPicker.value) {
                    monthPicker.value = new Date().toISOString().slice(0, 7);
                }
            }
            updateChart();
        }

        function updateChart() {
            if (!progressChart) return;

            let labels = [];
            let datasetsData = { Reading: [], Writing: [], Listening: [], Speaking: [] };

            if (appState.viewMode === 'daily') {
                // Show last 7 days
                for (let i = 6; i >= 0; i--) {
                    const d = new Date();
                    d.setDate(d.getDate() - i);
                    const dateStr = d.toISOString().split('T')[0];
                    labels.push(d.toLocaleDateString(undefined, { weekday: 'short' }));
                    const dayData = appState.history[dateStr] || { Reading: 0, Writing: 0, Listening: 0, Speaking: 0 };
                    SKILLS.forEach(s => datasetsData[s].push(dayData[s]));
                }
            } else if (appState.viewMode === 'monthly') {
                const picker = document.getElementById('month-picker');
                const selectedDate = picker.value ? new Date(picker.value + "-01") : new Date();
                const year = selectedDate.getFullYear();
                const month = selectedDate.getMonth();
                
                // Get number of days in selected month
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    labels.push(day); // Label as day number (1, 2, 3...)
                    const dayData = appState.history[dateStr] || { Reading: 0, Writing: 0, Listening: 0, Speaking: 0 };
                    SKILLS.forEach(s => datasetsData[s].push(dayData[s]));
                }
            }

            progressChart.data.labels = labels;
            progressChart.data.datasets.forEach(dataset => {
                dataset.data = datasetsData[dataset.label];
            });
            progressChart.update();
        }

        function initPieChart() {
            const ctx = document.getElementById('skillPieChart').getContext('2d');
            skillPieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: SKILLS,
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            SKILL_COLORS['Reading'],
                            SKILL_COLORS['Writing'],
                            SKILL_COLORS['Listening'],
                            SKILL_COLORS['Speaking']
                        ],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
            updatePieChart();
        }

        function updatePieChart() {
            if (!skillPieChart) return;

            // Calculate total completed tasks per skill (all time)
            const skillTotals = { Reading: 0, Writing: 0, Listening: 0, Speaking: 0 };
            
            Object.entries(appState.history).forEach(([date, data]) => {
                SKILLS.forEach(skill => {
                    skillTotals[skill] += data[skill] || 0;
                });
            });

            const data = SKILLS.map(skill => skillTotals[skill]);
            const total = data.reduce((a, b) => a + b, 0);

            skillPieChart.data.datasets[0].data = data;
            skillPieChart.update();

            // Update legend
            const legendContainer = document.getElementById('skill-legend');
            legendContainer.innerHTML = SKILLS.map(skill => {
                const count = skillTotals[skill];
                const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                return `
                    <div class="flex items-center gap-3 p-2 rounded-lg bg-slate-50">
                        <div class="w-4 h-4 rounded-full" style="background-color: ${SKILL_COLORS[skill]}"></div>
                        <div class="flex-1">
                            <p class="text-sm font-semibold">${skill}</p>
                            <p class="text-xs text-slate-500">${count} tasks ¬∑ ${percentage}%</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateMotivation() {
            const quotes = [
                "The limit of your language is the limit of your world.",
                "Every word you learn is a new window to the world.",
                "Consistency is more important than perfection.",
                "Don't stop until you're proud.",
                "Language is the key to global connection."
            ];
            const msg = document.getElementById('motivational-msg');
            const hour = new Date().getHours();
            if (hour < 12) msg.innerText = "Good morning! Let's start with some reading.";
            else if (hour < 18) msg.innerText = "Keep going! You're making great progress.";
            else msg.innerText = "Great job today. Reflect on what you learned.";
        }

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appState, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `linguisttrack_backup_${new Date().toISOString().split('T')[0]}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedState = JSON.parse(e.target.result);
                    if (importedState.tasks && importedState.history) {
                        appState = importedState;
                        saveToStorage();
                        renderAll();
                        alert("Data imported successfully!");
                    } else {
                        alert("Invalid backup file format.");
                    }
                } catch (err) {
                    alert("Error parsing file.");
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>